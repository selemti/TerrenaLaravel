Mapa de CRUDs y Brechas — Por Módulo

Fecha: 2025-10-17 08:19

Resumen
- Basado en rutas/controladores reales (routes/api.php, app/Http/Controllers/**), Livewire y ERDs.
- Se listan operaciones actuales y faltantes por dominio, y lógica de negocio pendiente.

Caja (cortes)
- Endpoints actuales (lectura/escritura):
  - Cajas: GET /api/caja/cajas → lista sesiones/terminales del día.
  - Sesiones: GET /api/caja/sesiones/activa → lectura por terminal/usuario.
  - Precortes: preflight (GET/POST), create (POST), update (POST), show (GET), totales (GET), status (GET/POST), enviar (POST).
  - Postcortes: create (POST), update (POST), show (GET), detalle (GET); cierra sesión si validado.
  - Conciliación: GET /api/caja/conciliacion/{sesion_id}.
  - Formas de pago: GET /api/caja/formas-pago.
- Brechas CRUD:
  - Precorte/Postcorte: sin DELETE (probablemente no deseable en producción; considerar anulación/auditoría en lugar de borrado duro).
  - Sesiones: no hay endpoints para abrir/cerrar manual (se hace por flujo de cortes; coherente).
  - Catálogo de Formas de Pago: solo lectura en API; faltan create/update/delete si se administrarán por backoffice.
- Lógica de negocio pendiente:
  - Autorización por rol (spatie/permission) para cada acción (preflight, create/update, validar postcorte).
  - Prevención doble-submit y estados de Wizard; idempotencia en createLegacy (ya aproximada) y update.
  - Auditoría estructurada (selemti.auditoria) para errores/acciones clave.

POS (public)
- Tablas clave: public.ticket, public.terminal, public.users, public.gratuity, public.shift.
- Endpoints directos: no CRUD propio (lectura indirecta vía endpoints de Caja y consultas internas).
- Brechas CRUD: no aplica (evitar escrituras en POS). Definir servicios de lectura agregada (reportes, KPIs, búsquedas).

Inventario
- Endpoints actuales:
  - Items CRUD, related: kardex, batches, vendors (attach/byItem): app/Http/Controllers/Api/Inventory/*.
- Livewire UI: ItemsIndex, ReceptionsIndex/Create, LotsIndex.
- Brechas CRUD:
  - Vendors catálogo (proveedores) como CRUD propio (si no cubierto por Livewire Catálogos/ProveedoresIndex).
  - Recepciones: endpoints formales de API para list/create/show (UI los gestiona por Livewire; definir API si se expone).
  - Reglas de validación consistentes (FormRequests) y policies.

Catálogos
- Livewire: Unidades, Conversiones, Almacenes, Proveedores, Sucursales, Stock Policy.
- Brechas CRUD:
  - Exponer endpoints REST (opcional) si se requiere fuera de Livewire.
  - Validaciones (unicidad, rangos), soft deletes si procede.

Recetas
- Livewire: RecipesIndex, RecipeEditor; modelos receta_*, presentaciones, conversiones.
- Brechas CRUD:
  - Endpoints REST opcionales; versionado y publicación/borrador; validación de costos.

Transversales
- Seguridad: aplicar auth/roles; kernel estándar; CORS.
- DB: índices en FKs (precorte_efectivo), limpiar duplicidades (precorte sesion_id), parcial en ticket si es necesario.
- Pruebas: cubrir precorte/postcorte/conciliación (Feature), y catálogos.

