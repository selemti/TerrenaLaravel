Doc General — Backoffice Restaurante (Laravel)

Fecha: 2025-10-17 01:26

Resumen del proyecto
- Propósito: backoffice de restaurante con módulo de Caja (cortes), Inventario, Catálogos, Recetas y KDS.
- POS objetivo: FloreantPOS (las conciliaciones y cortes referencian su flujo/terminología).
- Frontend: Blade + assets estáticos en `public/assets` y algunos módulos Livewire (para catálogos/inventario).

Estructura relevante y convenciones
- PSR-4 (composer): namespace base `App\` → `app/`.
- Controladores API por dominio: `app/Http/Controllers/Api/{Caja,Inventory,Unidades,...}`.
- Rutas: `routes/web.php` (vistas/Livewire), `routes/api.php` (JSON REST, prefijos por módulo).
- Vistas: `resources/views/**` con layout principal `layouts/terrena`.
- Assets: `public/assets/{css,js,libs,vendor}` con módulos ES para Caja.
- Livewire: `app/Livewire/**` (Catálogos, Inventario, Recetas, KDS).

Dependencias (composer.json)
- laravel/framework ^12.0 — Framework base.
- darkaonline/l5-swagger ^9.0 — Documentación Swagger/OpenAPI.
- livewire/livewire 3.7.0-beta.1 — Componentes reactivas para algunas pantallas.
- spatie/laravel-permission ^6.21 — Roles y permisos (no mapeados aún en rutas del módulo Caja).
- tymon/jwt-auth ^2.2 — JWT (no se ve integrado aún en rutas de Caja).
- Desarrollo: breeze, pint, sail, collision, phpunit 11.5, faker, pail.

Dependencias front (package.json)
- Vite ^7, laravel-vite-plugin ^2 — Tooling de build (coexiste con assets manuales en `public/assets`).
- Tailwind + forms, PostCSS/autoprefixer — estilado (no parece usado en vistas Caja actuales).
- Axios ^1.11 — HTTP (el módulo Caja usa `fetch` propio en helpers.js).
- Bootstrap ^5.3.8 y Cleave.js — UI y formateo.

Configuración de entorno (sin credenciales)
- DB: driver `pgsql` (config/database.php). `search_path` toma `DB_SCHEMA` del .env (por defecto `public`).
- Cache/Queue/Mail: no se observan personalizaciones notables en este repo; valores por defecto de Laravel (pendiente confirmar con `php artisan config:show` si se aprueba).
- BASE URL: layout expone `window.__BASE__ = url('/')` para módulos JS.

Versiones (detectable por código)
- PHP requerido: ^8.2 (composer.json).
- Laravel: ^12.0 (composer.json). 
- PHPUnit: ^11.5 (dev).
- Nota: Para listado efectivo de extensiones/versión PHP/Laravel, proponer `php -v`, `php artisan --version` (requiere aprobación).

Seguridad
- Guards/Policies: no se encontraron Policies en `app/Policies`. spatie/permission está instalado pero no mapeado al módulo Caja.
- CORS: `ApiResponseMiddleware` añade CORS permisivo en env local; Kernel custom no estándar podría impedir su aplicación.
- Rate limiting: presente por defecto en grupo `api` si Kernel estándar se aplica; revisar.
- Auth: routes/api.php expone `/api/caja/*` sin `auth` explícito. Existe JWT (tymon) y Breeze, pero no se ve enforcement en módulo Caja.

Vulnerabilidades y plan
- Riesgo: endpoints de Caja sin protección de auth/roles → Exposición de datos y mutaciones (precorte/postcorte) si el servidor es accesible.
- Riesgo: Kernel ubicado en `app/Http/Middleware/Kernel.php` (no estándar) sugiere que el middleware API no se aplica.
- Plan de auditoría (con aprobación previa):
  - composer audit — detectar CVEs PHP.
  - npm audit — detectar CVEs JS.
  - php artisan route:list — validar middlewares efectivos.
  - Revisar configuración de CORS/CSRF para `api`.

